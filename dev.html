<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Spatial Memory Trainer – DEV</title>

<style>
:root{
  --bg:#0b1020;
  --panel:#111a33;
  --arena:#101a35;
  --text:#eef;
  --muted:#b7c0ee;
}
html,body{
  margin:0; padding:0;
  background:var(--bg);
  color:var(--text);
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto;
}
#app{max-width:520px;margin:0 auto;padding:12px;}
.panel{
  background:linear-gradient(180deg,#121c3a,#0d1430);
  border-radius:14px;
  padding:10px;
  box-shadow:0 8px 30px rgba(0,0,0,.35);
}
.row{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
button{
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.15);
  color:#fff;
  border-radius:12px;
  padding:8px 14px;
  font-size:16px;
}
button.primary{
  font-size:18px;
  padding:10px 18px;
  box-shadow:0 0 12px rgba(120,160,255,.6);
}
button:active{transform:scale(.97)}
.indicators span{
  display:inline-block;width:8px;height:8px;border-radius:50%;
  background:#666;margin:0 2px;
}
.indicators span.on{background:#fff}
.label{opacity:.85}
#arena{
  margin-top:12px;
  height:460px;
  background:radial-gradient(circle at top,#18255a,#0b122d);
  border-radius:18px;
  position:relative;
  overflow:hidden;
}
.circle{
  position:absolute;
  border-radius:50%;
  box-shadow:0 0 14px rgba(255,255,255,.4);
}
.msg{
  margin-top:8px;
  opacity:.85;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.msg button{padding:4px 10px}
.modal{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.55);
  display:flex;
  align-items:center;
  justify-content:center;
}
.modal .panel{width:80%;text-align:center}
</style>
</head>

<body>
<div id="app">
  <div class="panel">
    <div class="row">
      <button id="playBtn" class="primary">Play</button>
      <div class="indicators" id="missDots">
        <span></span><span></span><span></span>
      </div>
      <button id="endBtn">End Game</button>
      <div class="label">N = <span id="nVal">2</span></div>
    </div>

    <div class="row" style="margin-top:8px">
      <div class="label">Timing</div>
      <button id="tMinus">−</button>
      <button id="tPlus">+</button>

      <div class="label" style="margin-left:10px">Size</div>
      <button id="sMinus">−</button>
      <button id="sPlus">+</button>
    </div>

    <div class="msg">
      <span id="status">Press Play once. Then it runs continuously.</span>
      <button onclick="status.textContent=''">×</button>
    </div>
  </div>

  <div id="arena"></div>
</div>

<script>
const arena = document.getElementById('arena');
const playBtn = document.getElementById('playBtn');
const endBtn = document.getElementById('endBtn');
const status = document.getElementById('status');
const nVal = document.getElementById('nVal');
const dots = [...document.querySelectorAll('#missDots span')];

let N = 2;
let timing = 800;
let size = 60;
let seq = [];
let user = [];
let playing = false;
let misses = 0;

const colors = ['#4aa3ff','#ff5fa2','#5dff8f','#ffd45a','#ff7a4a','#b07aff'];

function randColor(){
  return colors[Math.floor(Math.random()*colors.length)];
}

function clearArena(){
  arena.innerHTML='';
}

function dist(a,b){
  const dx=a.x-b.x, dy=a.y-b.y;
  return Math.sqrt(dx*dx+dy*dy);
}

function generatePositions(count){
  const pts=[];
  const pad = size + 14;
  let attempts=0;

  while(pts.length<count && attempts<2000){
    attempts++;
    const p={
      x: Math.random()*(arena.clientWidth-pad*2)+pad,
      y: Math.random()*(arena.clientHeight-pad*2)+pad,
      color: randColor()
    };
    if(pts.every(q=>dist(p,q) > size+16)) pts.push(p);
  }
  return pts;
}

function showSequence(){
  clearArena();
  user=[];
  const pts = generatePositions(N);
  seq = pts;

  let i=0;
  function flash(){
    if(i>=pts.length){
      status.textContent=`Your turn: click in order (1…${N}).`;
      enableInput();
      return;
    }
    const p=pts[i];
    const d=document.createElement('div');
    d.className='circle';
    d.style.width=d.style.height=size+'px';
    d.style.left=(p.x-size/2)+'px';
    d.style.top=(p.y-size/2)+'px';
    d.style.background=p.color;
    arena.appendChild(d);
    setTimeout(()=>{
      arena.removeChild(d);
      i++; setTimeout(flash,200);
    }, timing);
  }
  flash();
}

function enableInput(){
  seq.forEach((p,idx)=>{
    const d=document.createElement('div');
    d.className='circle';
    d.style.width=d.style.height=size+'px';
    d.style.left=(p.x-size/2)+'px';
    d.style.top=(p.y-size/2)+'px';
    d.style.background=p.color;
    d.onclick=()=>handleClick(idx);
    arena.appendChild(d);
  });
}

function handleClick(i){
  user.push(i);
  if(user[user.length-1]!==seq.indexOf(seq[i])){
    misses++;
    dots[misses-1].classList.add('on');
    if(misses>=3){
      endGame();
      return;
    }
  }
  if(user.length===seq.length){
    misses=0;
    dots.forEach(d=>d.classList.remove('on'));
    N++; nVal.textContent=N;
    setTimeout(showSequence,600);
  }
}

function endGame(){
  playing=false;
  clearArena();
  arena.innerHTML=`
    <div class="modal">
      <div class="panel">
        <h2>Final Score</h2>
        <h1>N = ${N}</h1>
        <button onclick="restart()">Play Again</button>
      </div>
    </div>`;
}

function restart(){
  arena.innerHTML='';
  misses=0;
  dots.forEach(d=>d.classList.remove('on'));
  N=2; nVal.textContent=N;
  playing=true;
  showSequence();
}

playBtn.onclick=()=>{
  if(playing) return;
  playing=true;
  restart();
};

endBtn.onclick=endGame;

document.getElementById('tMinus').onclick=()=>timing=Math.min(1200,timing+100);
document.getElementById('tPlus').onclick=()=>timing=Math.max(300,timing-100);
document.getElementById('sMinus').onclick=()=>size=Math.max(40,size-8);
document.getElementById('sPlus').onclick=()=>size=Math.min(110,size+8);
</script>
</body>
</html>