<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Spatial Memory Trainer – DEV v35</title>

<style>
:root{
  --bg:#0b1020;
  --panel:#111a33;
  --arena:#101a35;
  --text:#eef;
  --muted:#b7c0ee;
}
html,body{margin:0;height:100%;background:radial-gradient(120% 120% at 20% 10%,#16235c 0%,#0b1020 60%);}
body{font-family:-apple-system,system-ui,Segoe UI,Roboto,sans-serif;color:var(--text);}

#ui{padding:12px;max-width:720px;margin:auto;}
.bar{display:flex;flex-wrap:wrap;gap:10px;align-items:center;
     background:rgba(255,255,255,.06);border-radius:14px;padding:10px;}
.btn{
  background:linear-gradient(180deg,#2a3fff,#1a2bb3);
  color:white;border:none;border-radius:14px;
  padding:10px 16px;font-size:18px;box-shadow:0 0 18px rgba(80,120,255,.5);
}
.small{font-size:14px;padding:6px 12px;box-shadow:none}
.pill{background:rgba(255,255,255,.08);border-radius:999px;padding:6px 10px}
.levels span{opacity:.4}
.levels span.on{opacity:1}
#arena{
  margin:12px auto;height:70vh;
  background:radial-gradient(120% 120% at 20% 10%,#142a5a 0%,#0b1020 70%);
  border-radius:20px;position:relative;overflow:hidden;
}
.circle{
  position:absolute;border-radius:50%;
  box-shadow:0 0 25px currentColor;
}
.line{
  position:absolute;height:2px;background:rgba(255,255,255,.7);
  transform-origin:left center;
}
.note{margin-top:8px;color:var(--muted)}
.note .x{margin-left:8px;cursor:pointer}
</style>
</head>

<body>
<div id="ui">
  <div class="bar">
    <button id="play" class="btn">Play</button>
    <span class="levels" id="misses"></span>
    <button id="end" class="small">End Game</button>
    <span class="pill">N = <b id="n">2</b></span>
    <span class="pill">DEV v35</span>
  </div>

  <div class="bar">
    <span class="pill">Timing</span>
    <button id="tminus" class="small">−</button>
    <span id="tlevel">●●●○○</span>
    <button id="tplus" class="small">+</button>

    <span class="pill">Size</span>
    <button id="sminus" class="small">−</button>
    <span id="slevel">●●●○○</span>
    <button id="splus" class="small">+</button>
  </div>

  <div class="note" id="note">
    Press <b>Play</b> once. Then it runs continuously.
    <span class="x" onclick="note.remove()">✕</span>
  </div>

  <div id="arena"></div>
</div>

<script>
/* --- game state --- */
const arena=document.getElementById('arena');
const playBtn=document.getElementById('play');
const endBtn=document.getElementById('end');
const nEl=document.getElementById('n');
const missesEl=document.getElementById('misses');

let N=2, timing=3, sizeLevel=3;
let seq=[], idx=0, playing=false, misses=0;

/* --- utils --- */
const rand=(a,b)=>a+Math.random()*(b-a);
const colors=['#ff5fa2','#ffd85f','#4fa7ff','#6bff7b','#c56bff','#ff8f4f'];

function updateLevels(){
  document.getElementById('tlevel').textContent='●'.repeat(timing)+'○'.repeat(5-timing);
  document.getElementById('slevel').textContent='●'.repeat(sizeLevel)+'○'.repeat(5-sizeLevel);
}
updateLevels();

function resetMisses(){
  misses=0;
  missesEl.innerHTML='<span class="on">●</span><span class="on">●</span><span class="on">●</span>';
}
resetMisses();

/* --- placement without overlap --- */
function placeCircles(count){
  arena.innerHTML='';
  const r=20+sizeLevel*12;
  const placed=[];
  for(let i=0;i<count;i++){
    let ok=false,x,y;
    while(!ok){
      x=rand(r,arena.clientWidth-r);
      y=rand(r,arena.clientHeight-r);
      ok=true;
      for(const p of placed){
        if(Math.hypot(p.x-x,p.y-y)<r*2.2){ok=false;break;}
      }
    }
    placed.push({x,y});
    const c=document.createElement('div');
    c.className='circle';
    c.style.width=c.style.height=r*2+'px';
    c.style.left=(x-r)+'px';
    c.style.top=(y-r)+'px';
    c.style.color=colors[Math.floor(Math.random()*colors.length)];
    arena.appendChild(c);
  }
  return [...arena.children];
}

/* --- sequence --- */
function showSequence(){
  const circles=placeCircles(N);
  seq=[...circles];
  let i=0;
  playing=true;
  function step(){
    if(i>0) drawLine(seq[i-1],seq[i]);
    seq[i].style.filter='brightness(1.8)';
    setTimeout(()=>{
      seq[i].style.filter='';
      i++;
      if(i<seq.length) setTimeout(step,600-timing*80);
      else{idx=0;playing=false;}
    },300);
  }
  step();
}

function drawLine(a,b){
  const ax=a.offsetLeft+a.offsetWidth/2;
  const ay=a.offsetTop+a.offsetHeight/2;
  const bx=b.offsetLeft+b.offsetWidth/2;
  const by=b.offsetTop+b.offsetHeight/2;
  const l=document.createElement('div');
  l.className='line';
  const d=Math.hypot(bx-ax,by-ay);
  l.style.width=d+'px';
  l.style.left=ax+'px';
  l.style.top=ay+'px';
  l.style.transform=`rotate(${Math.atan2(by-ay,bx-ax)}rad)`;
  arena.appendChild(l);
}

/* --- input --- */
arena.addEventListener('click',e=>{
  if(playing||!seq.length)return;
  const t=e.target;
  if(t!==seq[idx]){
    misses++;
    missesEl.children[misses-1].classList.remove('on');
    if(misses>=3){endGame();return;}
    return;
  }
  idx++;
  if(idx===seq.length){
    N++;nEl.textContent=N;
    resetMisses();
    setTimeout(showSequence,600);
  }
});

/* --- controls --- */
playBtn.onclick=()=>{if(!playing){N=2;nEl.textContent=N;resetMisses();showSequence();}};
endBtn.onclick=endGame;
document.getElementById('tminus').onclick=()=>{if(timing>1){timing--;updateLevels();}};
document.getElementById('tplus').onclick=()=>{if(timing<5){timing++;updateLevels();}};
document.getElementById('sminus').onclick=()=>{if(sizeLevel>1){sizeLevel--;updateLevels();}};
document.getElementById('splus').onclick=()=>{if(sizeLevel<5){sizeLevel++;updateLevels();}};

function endGame(){
  arena.innerHTML='';
  playing=false;
  seq=[];
}
</script>
</body>
</html>
